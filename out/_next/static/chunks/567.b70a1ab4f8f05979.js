"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[567],{57567:(e,r,t)=>{t.r(r),t.d(r,{GSIViewer:()=>h});var a=t(95155),l=t(12115),s=t(89139),n=t(13318),o=t(92033),i=t(57971),c=t(90850),d=t(51190),u=t(63263);t(18720);var x=t(68497);function h(e){let{id:r,url:t,type:h,onLoadComplete:m,onError:g}=e,[f,p]=(0,l.useState)(!0),[w,b]=(0,l.useState)(null),[v,y]=(0,l.useState)(1.5),[j,N]=(0,l.useState)(null);(0,l.useRef)(null);let P=(0,l.useRef)(null);(0,l.useEffect)(()=>{console.log("GSIViewer: Loading ".concat(h," from ").concat(t)),p(!0);let e=x.B.getProgress(r),a=(null==e?void 0:e.currentPage)||1;"pdf"===h?k(a):"docx"===h?E():"video"===h||"image"===h?(p(!1),null==m||m()):(p(!1),null==g||g("Type de fichier non reconnu."))},[t,h]);let k=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;try{let a=await fetch(t);if(!a.ok)throw Error("HTTP ".concat(a.status));let l=await a.arrayBuffer(),n=new Uint8Array(l.slice(0,5));if(!String.fromCharCode(...n).includes("%PDF-"))throw Error("Le fichier n'est pas un document PDF valide.");let o=s.YE({data:new Uint8Array(l)}),i=await o.promise;b({numPages:i.numPages,currentPage:e});let c=await i.getPage(e),d=c.getViewport({scale:r}),u=P.current;if(!u)return;let x=u.getContext("2d");if(!x)return;u.height=d.height,u.width=d.width,await c.render({canvasContext:x,viewport:d}).promise,p(!1),null==m||m()}catch(e){console.error("PDF Render Error:",e),p(!1),null==g||g("Erreur de rendu PDF: ".concat(e.message||"Fichier invalide"))}},E=async()=>{try{console.log("GSIViewer: Rendering DOCX from",t);let e=await fetch(t);if(!e.ok)throw Error("HTTP ".concat(e.status," - \xc9chec du chargement du fichier."));let r=await e.arrayBuffer();if(0===r.byteLength)throw Error("Fichier vide ou corrompu.");let a=n.convertToHtml||(null==n?void 0:n.convertToHtml)||n.convertToHtml;if("function"!=typeof a)throw Error("Moteur de rendu DOCX non disponible.");let l=await a({arrayBuffer:r},{styleMap:["p[style-name='Title'] => h1:fresh","p[style-name='Heading 1'] => h2:fresh","p[style-name='Heading 2'] => h3:fresh"]});N(l.value),l.messages.length>0&&console.warn("Mammoth messages:",l.messages),p(!1),null==m||m()}catch(e){console.error("DOCX Render Error:",e),p(!1),null==g||g("Erreur de rendu DOCX: ".concat(e.message))}},C=e=>{if(!w)return;let t=w.currentPage+e;t>=1&&t<=w.numPages&&(p(!0),k(t),x.B.saveProgress(r,{currentPage:t}))},S=e=>{let r=Math.min(Math.max(v+e,.5),4);y(r),"pdf"===h&&(p(!0),k((null==w?void 0:w.currentPage)||1,r))};return(0,a.jsxs)("div",{className:"w-full h-full flex flex-col bg-gray-50 overflow-hidden",children:[f&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 z-20 backdrop-blur-sm",children:[(0,a.jsx)(o.A,{className:"w-10 h-10 text-primary animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"GSI Rendering Engine..."})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto flex flex-col items-center p-4",children:["pdf"===h&&(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"overflow-auto max-w-full",children:(0,a.jsx)("canvas",{ref:P,className:"shadow-2xl rounded-sm bg-white mx-auto",style:{width:"auto",height:"auto"}})}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 z-30",children:[(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100",children:[(0,a.jsx)("button",{onClick:()=>S(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(100*v),"%"]}),(0,a.jsx)("button",{onClick:()=>S(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(c.A,{size:20})})]}),w&&(0,a.jsxs)("div",{className:"bg-gray-900/90 text-white px-6 py-3 rounded-full flex items-center gap-6 backdrop-blur-md shadow-2xl border border-white/10",children:[(0,a.jsx)("button",{onClick:()=>C(-1),disabled:w.currentPage<=1,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,a.jsx)(d.A,{size:24})}),(0,a.jsxs)("span",{className:"text-[10px] font-black uppercase tracking-widest whitespace-nowrap",children:["Page ",w.currentPage," / ",w.numPages]}),(0,a.jsx)("button",{onClick:()=>C(1),disabled:w.currentPage>=w.numPages,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,a.jsx)(u.A,{size:24})})]})]})]}),"docx"===h&&j&&(0,a.jsx)("div",{className:"w-full max-w-2xl bg-white p-8 shadow-lg rounded-2xl prose prose-sm prose-indigo animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:j}})}),"video"===h&&(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-black rounded-3xl overflow-hidden shadow-2xl",children:(0,a.jsx)("video",{src:t,className:"w-full max-h-full",controls:!0,autoPlay:!0,playsInline:!0,onError:()=>null==g?void 0:g("Format vid\xe9o non support\xe9.")})}),"image"===h&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"overflow-auto max-w-full rounded-2xl shadow-xl",children:(0,a.jsx)("img",{src:t,style:{transform:"scale(".concat(v/1.5,")"),transformOrigin:"top center"},className:"h-auto transition-transform duration-200",alt:"Document",onLoad:()=>{p(!1),null==m||m()},onError:()=>{p(!1),null==g||g("\xc9chec du chargement de l'image.")}})}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100 z-30",children:[(0,a.jsx)("button",{onClick:()=>S(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(v/1.5*100),"%"]}),(0,a.jsx)("button",{onClick:()=>S(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(c.A,{size:20})})]})]})]})]})}s.EA.workerSrc="/pdf.worker.min.mjs"}}]);