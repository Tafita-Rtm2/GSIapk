"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[567],{57567:(e,r,t)=>{t.r(r),t.d(r,{GSIViewer:()=>g});var a=t(95155),s=t(12115),l=t(89139),n=t(13318),o=t(92033),i=t(57971),c=t(90850),d=t(51190),u=t(63263);t(18720);var x=t(68497);function g(e){var r;let{id:t,url:g,type:m,onLoadComplete:h,onError:p}=e,[f,b]=(0,s.useState)(!0),[w,v]=(0,s.useState)(null),[y,j]=(0,s.useState)(1.5),[N,k]=(0,s.useState)(null);(0,s.useRef)(null);let P=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!g){b(!1),null==p||p("Aucun contenu \xe0 afficher.");return}console.log("GSIViewer: Loading ".concat(m," from ").concat(g.substring(0,50),"...")),b(!0);let e=x.B.getProgress(t),r=(null==e?void 0:e.currentPage)||1;"pdf"===m?C(r):"docx"===m?E():"video"===m||"image"===m||"text"===m?(b(!1),null==h||h()):(b(!1),null==p||p("Type de fichier non reconnu."))},[g,m]);let C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y;try{let t=l.YE(g),a=await t.promise;v({numPages:a.numPages,currentPage:e});let s=await a.getPage(e),n=s.getViewport({scale:r}),o=P.current;if(!o)return;let i=o.getContext("2d");if(!i)return;o.height=n.height,o.width=n.width,await s.render({canvasContext:i,viewport:n}).promise,b(!1),null==h||h()}catch(e){console.error("PDF Render Error:",e),b(!1),null==p||p("Erreur de rendu PDF: ".concat(e.message||"Fichier invalide"))}},E=async()=>{try{console.log("GSIViewer: Rendering DOCX from",g);let e=await fetch(g);if(!e.ok)throw Error("HTTP ".concat(e.status," - \xc9chec du chargement du fichier."));let r=await e.arrayBuffer();if(0===r.byteLength)throw Error("Fichier vide ou corrompu.");let t=n.convertToHtml||(null==n?void 0:n.convertToHtml)||n.convertToHtml;if("function"!=typeof t)throw Error("Moteur de rendu DOCX non disponible.");let a=await t({arrayBuffer:r},{styleMap:["p[style-name='Title'] => h1:fresh","p[style-name='Heading 1'] => h2:fresh","p[style-name='Heading 2'] => h3:fresh"]});k(a.value),a.messages.length>0&&console.warn("Mammoth messages:",a.messages),b(!1),null==h||h()}catch(e){console.error("DOCX Render Error:",e),b(!1),null==p||p("Erreur de rendu DOCX: ".concat(e.message))}},M=e=>{if(!w)return;let r=w.currentPage+e;if(r>=1&&r<=w.numPages){b(!0),C(r);let e=Math.round(r/w.numPages*100),a=x.B.getProgress(t)||{};x.B.saveProgress(t,{currentPage:r,percent:Math.max(a.percent||0,e),completed:a.completed||100===e})}},S=e=>{let r=Math.min(Math.max(y+e,.5),4);j(r),"pdf"===m&&(b(!0),C((null==w?void 0:w.currentPage)||1,r))},R=w?Math.round(w.currentPage/w.numPages*100):(null==(r=x.B.getProgress(t))?void 0:r.percent)||0;return(0,a.jsxs)("div",{className:"w-full h-full flex flex-col bg-gray-50 overflow-hidden relative",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gray-100 z-30",children:(0,a.jsx)("div",{className:"h-full bg-indigo-600 transition-all duration-500",style:{width:"".concat(R,"%")}})}),f&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 z-20 backdrop-blur-sm",children:[(0,a.jsx)(o.A,{className:"w-10 h-10 text-primary animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"GSI Rendering Engine..."})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto flex flex-col items-center p-4",children:["pdf"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"overflow-auto max-w-full",children:(0,a.jsx)("canvas",{ref:P,className:"shadow-2xl rounded-sm bg-white mx-auto",style:{width:"auto",height:"auto"}})}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 z-30",children:[(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100",children:[(0,a.jsx)("button",{onClick:()=>S(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(100*y),"%"]}),(0,a.jsx)("button",{onClick:()=>S(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(c.A,{size:20})})]}),w&&(0,a.jsxs)("div",{className:"bg-gray-900/90 text-white px-6 py-3 rounded-full flex items-center gap-6 backdrop-blur-md shadow-2xl border border-white/10",children:[(0,a.jsx)("button",{onClick:()=>M(-1),disabled:w.currentPage<=1,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,a.jsx)(d.A,{size:24})}),(0,a.jsxs)("span",{className:"text-[10px] font-black uppercase tracking-widest whitespace-nowrap",children:["Page ",w.currentPage," / ",w.numPages]}),(0,a.jsx)("button",{onClick:()=>M(1),disabled:w.currentPage>=w.numPages,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,a.jsx)(u.A,{size:24})})]})]})]}),"docx"===m&&N&&(0,a.jsx)("div",{className:"w-full max-w-2xl bg-white p-8 shadow-lg rounded-2xl prose prose-sm prose-indigo animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:N}})}),"video"===m&&(0,a.jsxs)("div",{className:"w-full h-full flex items-center justify-center bg-black rounded-3xl overflow-hidden shadow-2xl relative group",onContextMenu:e=>e.preventDefault(),children:[(0,a.jsxs)("video",{className:"w-full h-full object-contain",controls:!0,autoPlay:!0,playsInline:!0,crossOrigin:"anonymous",preload:"auto",controlsList:"nodownload",onLoadedData:()=>b(!1),onError:e=>{var r;let t=e.currentTarget;if(console.error("GSI Stream Error:",null==(r=t.error)?void 0:r.code,t.src),t.src.includes("proxy")){let e=new URL(t.src).searchParams.get("url");e&&(console.log("Retrying with raw URL..."),t.src=e)}},children:[(0,a.jsx)("source",{src:g,type:"video/mp4"}),(0,a.jsx)("source",{src:g,type:"video/webm"}),(0,a.jsx)("source",{src:g,type:"video/quicktime"}),"Votre navigateur ne supporte pas le streaming direct."]},g),(0,a.jsx)("div",{className:"absolute top-4 right-4 bg-green-500/20 backdrop-blur-md px-3 py-1 rounded-full border border-green-500/30 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("p",{className:"text-[8px] font-black text-green-400 uppercase tracking-[0.2em]",children:"Live Stream Active"})})]}),"image"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 group",onContextMenu:e=>e.preventDefault(),children:[(0,a.jsx)("div",{className:"overflow-auto max-w-full rounded-2xl shadow-2xl bg-white p-2",children:(0,a.jsx)("img",{src:g,draggable:!1,crossOrigin:"anonymous",style:{transform:"scale(".concat(y/1.5,")"),transformOrigin:"top center"},className:"h-auto transition-all duration-300 rounded-xl",alt:"Content View",onLoad:()=>{b(!1),null==h||h()},onError:e=>{let r=e.currentTarget;if(r.src.includes("proxy")){let e=new URL(r.src).searchParams.get("url");e&&(r.src=e)}b(!1)}},g)}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100 z-30",children:[(0,a.jsx)("button",{onClick:()=>S(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(y/1.5*100),"%"]}),(0,a.jsx)("button",{onClick:()=>S(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(c.A,{size:20})})]})]}),"text"===m&&(0,a.jsxs)("div",{className:"w-full max-w-2xl bg-white p-8 shadow-lg rounded-[32px] border border-gray-100 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,a.jsx)("h3",{className:"text-[10px] font-black uppercase text-indigo-600 mb-4 tracking-widest",children:"R\xe9ponse de l'\xe9l\xe8ve"}),(0,a.jsx)("div",{className:"prose prose-sm prose-indigo max-w-none whitespace-pre-wrap font-medium text-gray-700 leading-relaxed",children:g})]})]})]})}l.EA.workerSrc="https://unpkg.com/pdfjs-dist@5.4.624/build/pdf.worker.min.mjs"}}]);