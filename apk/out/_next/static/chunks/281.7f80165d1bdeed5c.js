"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[281],{66281:(e,t,r)=>{r.r(t),r.d(t,{GSIViewer:()=>g});var a=r(95155),l=r(12115),s=r(73577),n=r(77560),o=r(22783),i=r(63025),c=r(82852),d=r(25012),u=r(15325);r(30814);var x=r(63699);function g(e){var t;let{id:r,url:g,urls:h=[],type:m,onLoadComplete:f,onError:p}=e,[b,w]=(0,l.useState)(!0),[v,y]=(0,l.useState)(g),[j,N]=(0,l.useState)(h.length>0?h:[g]),[k,P]=(0,l.useState)(0),[C,E]=(0,l.useState)(null),[M,S]=(0,l.useState)(1.5),[z,A]=(0,l.useState)(null);(0,l.useRef)(null);let D=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=Array.isArray(h)?h:[];if(!g&&0===e.length){w(!1),null==p||p("Aucun contenu \xe0 afficher.");return}let t=e.length>0?e:[g];if(N(t),y(t[0]),P(0),console.log("GSIViewer: Direct play for ".concat(m," from ").concat(t[0].substring(0,50),"...")),"image"===m||"video"===m||"text"===m)w(!1),null==f||f();else{w(!0);let e=x.B.getProgress(r),t=(null==e?void 0:e.currentPage)||1;"pdf"===m?I(t):"docx"===m&&R()}},[g,h,m]);let I=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;try{let a=s.YE(r),l=await a.promise;E({numPages:l.numPages,currentPage:e});let n=await l.getPage(e),o=n.getViewport({scale:t}),i=D.current;if(!i)return;let c=i.getContext("2d");if(!c)return;i.height=o.height,i.width=o.width,await n.render({canvasContext:c,viewport:o}).promise,w(!1),null==f||f()}catch(e){console.error("PDF Render Error:",e),w(!1),null==p||p("Erreur de rendu PDF: ".concat(e.message||"Fichier invalide"))}},R=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;try{console.log("GSIViewer: Rendering DOCX from",e);let t=await fetch(e);if(!t.ok)throw Error("HTTP ".concat(t.status," - \xc9chec du chargement du fichier."));let r=await t.arrayBuffer();if(0===r.byteLength)throw Error("Fichier vide ou corrompu.");let a=n.convertToHtml||(null==n?void 0:n.convertToHtml)||n.convertToHtml;if("function"!=typeof a)throw Error("Moteur de rendu DOCX non disponible.");let l=await a({arrayBuffer:r},{styleMap:["p[style-name='Title'] => h1:fresh","p[style-name='Heading 1'] => h2:fresh","p[style-name='Heading 2'] => h3:fresh"]});A(l.value),l.messages.length>0&&console.warn("Mammoth messages:",l.messages),w(!1),null==f||f()}catch(e){console.error("DOCX Render Error:",e),w(!1),null==p||p("Erreur de rendu DOCX: ".concat(e.message))}},T=e=>{if(!C)return;let t=C.currentPage+e;if(t>=1&&t<=C.numPages){w(!0),I(t);let e=Math.round(t/C.numPages*100),a=x.B.getProgress(r)||{};x.B.saveProgress(r,{currentPage:t,percent:Math.max(a.percent||0,e),completed:a.completed||100===e})}},H=e=>{let t=Math.min(Math.max(M+e,.5),4);S(t),"pdf"===m&&(w(!0),I((null==C?void 0:C.currentPage)||1,t))},L=C?Math.round(C.currentPage/C.numPages*100):(null===(t=x.B.getProgress(r))||void 0===t?void 0:t.percent)||0;return(0,a.jsxs)("div",{className:"w-full h-full flex flex-col bg-gray-50 overflow-hidden relative",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gray-100 z-30",children:(0,a.jsx)("div",{className:"h-full bg-indigo-600 transition-all duration-500",style:{width:"".concat(L,"%")}})}),b&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 z-20 backdrop-blur-sm",children:[(0,a.jsx)(o.A,{className:"w-10 h-10 text-primary animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"GSI Rendering Engine..."})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto flex flex-col items-center p-4",children:["pdf"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"overflow-auto max-w-full",children:(0,a.jsx)("canvas",{ref:D,className:"shadow-2xl rounded-sm bg-white mx-auto",style:{width:"auto",height:"auto"}})}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 z-30",children:[(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100",children:[(0,a.jsx)("button",{onClick:()=>H(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(100*M),"%"]}),(0,a.jsx)("button",{onClick:()=>H(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(c.A,{size:20})})]}),C&&(0,a.jsxs)("div",{className:"bg-gray-900/90 text-white px-6 py-3 rounded-full flex items-center gap-6 backdrop-blur-md shadow-2xl border border-white/10",children:[(0,a.jsx)("button",{onClick:()=>T(-1),disabled:C.currentPage<=1,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,a.jsx)(d.A,{size:24})}),(0,a.jsxs)("span",{className:"text-[10px] font-black uppercase tracking-widest whitespace-nowrap",children:["Page ",C.currentPage," / ",C.numPages]}),(0,a.jsx)("button",{onClick:()=>T(1),disabled:C.currentPage>=C.numPages,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,a.jsx)(u.A,{size:24})})]})]})]}),"docx"===m&&z&&(0,a.jsx)("div",{className:"w-full max-w-2xl bg-white p-8 shadow-lg rounded-2xl prose prose-sm prose-indigo animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:z}})}),"video"===m&&(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-black overflow-hidden relative",onContextMenu:e=>e.preventDefault(),children:(0,a.jsx)("video",{src:v,className:"w-full h-full object-contain",controls:!0,autoPlay:!0,playsInline:!0,preload:"auto",controlsList:"nodownload",onLoadedData:()=>w(!1),onError:e=>{var t,r;let a=e.currentTarget;if(console.error("GSI Media Error:",null===(t=a.error)||void 0===t?void 0:t.code,a.src),w(!1),a.src.includes("proxy")&&(null===(r=a.error)||void 0===r?void 0:r.code)===4){let e=new URL(a.src).searchParams.get("url");e&&(a.src=e)}},children:"Votre navigateur ne supporte pas la lecture directe."},v)}),"image"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center p-2 w-full",onContextMenu:e=>e.preventDefault(),children:[(0,a.jsx)("div",{className:"overflow-auto max-w-full bg-white shadow-lg border border-gray-100 w-full flex flex-col items-center space-y-4 py-8",children:j.map((e,t)=>(0,a.jsx)("img",{src:e,draggable:!1,style:{transform:"scale(".concat(M/1.5,")"),transformOrigin:"top center"},className:"max-w-full h-auto block mx-auto rounded-lg shadow-sm",alt:"Page ".concat(t+1),onLoad:()=>{t===j.length-1&&(w(!1),null==f||f())},onError:()=>w(!1)},"".concat(e,"-").concat(t)))}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100 z-30",children:[(0,a.jsx)("button",{onClick:()=>H(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(M/1.5*100),"%"]}),(0,a.jsx)("button",{onClick:()=>H(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,a.jsx)(c.A,{size:20})})]}),j.length>1&&(0,a.jsxs)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest z-30",children:[j.length," Images charg\xe9es"]})]}),"text"===m&&(0,a.jsxs)("div",{className:"w-full max-w-2xl bg-white p-8 shadow-lg rounded-[32px] border border-gray-100 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,a.jsx)("h3",{className:"text-[10px] font-black uppercase text-indigo-600 mb-4 tracking-widest",children:"R\xe9ponse de l'\xe9l\xe8ve"}),(0,a.jsx)("div",{className:"prose prose-sm prose-indigo max-w-none whitespace-pre-wrap font-medium text-gray-700 leading-relaxed",children:g})]})]})]})}s.EA.workerSrc="https://unpkg.com/pdfjs-dist@5.4.624/build/pdf.worker.min.mjs"}}]);