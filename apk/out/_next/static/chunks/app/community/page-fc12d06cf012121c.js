(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{47069:(e,t,s)=>{Promise.resolve().then(s.bind(s,51241))},51241:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(95155),i=s(96149),r=s(52910),n=s(6943),l=s(47931),c=s(27500),d=s(26615),o=s(15567),x=s(94979),m=s(12115),p=s(68497),u=s(64269),h=s(87041);function g(){let{t:e}=(0,r.o)(),[t,s]=(0,m.useState)(null),[g,f]=(0,m.useState)([]),[b,j]=(0,m.useState)([]),[N,v]=(0,m.useState)(""),[y,w]=(0,m.useState)(null),k=(0,m.useRef)(null);(0,m.useEffect)(()=>{s(p.B.getCurrentUser());let e=p.B.subscribeMessages(e=>{j(e),setTimeout(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},100)}),t=p.B.subscribeUsers(e=>f(e));return()=>{e(),t()}},[]);let C=async e=>{if(e.preventDefault(),!N.trim())return;let t=N.trim(),s=y?{senderName:y.senderName,text:y.text}:void 0;v(""),w(null),await p.B.sendMessage(t,s)};return t?(0,a.jsx)(i.e,{children:(0,a.jsxs)("div",{className:"flex flex-col h-full bg-[#F8FAFC]",children:[(0,a.jsxs)("div",{className:"p-6 bg-white border-b border-gray-100 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-black text-gray-900 uppercase tracking-tight",children:"Communaut\xe9"}),(0,a.jsxs)("p",{className:"text-[9px] font-bold text-indigo-500 uppercase tracking-widest",children:[t.filiere," â€¢ ",t.niveau]})]}),(0,a.jsxs)("div",{className:"bg-indigo-50 px-3 py-1 rounded-full flex items-center gap-2",children:[(0,a.jsx)(n.A,{size:12,className:"text-indigo-600"}),(0,a.jsx)("span",{className:"text-[10px] font-black text-indigo-600",children:"En ligne"})]})]}),(0,a.jsxs)("div",{ref:k,className:"flex-1 overflow-y-auto p-6 space-y-6",children:[b.map((e,s)=>(0,a.jsxs)("div",{className:(0,u.cn)("flex gap-3 animate-in fade-in slide-in-from-bottom-2",e.senderId===t.id?"flex-row-reverse":"flex-row"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-indigo-50 border-2 border-white shadow-sm flex-shrink-0 overflow-hidden flex items-center justify-center",children:(0,a.jsx)("img",{src:(e=>{let t=g.find(t=>t.id===e.senderId),s=(null==t?void 0:t.photo)||e.senderPhoto;return p.B.getMediaUrl(s)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e.senderName)})(e),alt:"",className:"w-full h-full object-cover",onError:t=>{t.target.onerror=null,t.target.src="https://api.dicebear.com/7.x/initials/svg?seed=".concat(e.senderName)}})}),(0,a.jsxs)("div",{className:(0,u.cn)("flex flex-col max-w-[75%]",e.senderId===t.id?"items-end":"items-start"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1 px-1",children:[e.senderId!==t.id&&(0,a.jsx)("span",{className:"text-[9px] font-black text-gray-400 uppercase",children:e.senderName}),(0,a.jsx)("span",{className:"text-[7px] text-gray-300 font-bold",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{onContextMenu:t=>{t.preventDefault(),w(e)},onClick:()=>w(e),className:(0,u.cn)("p-4 rounded-[24px] text-sm font-medium shadow-sm active:scale-[0.98] transition-transform overflow-hidden",e.senderId===t.id?"bg-indigo-600 text-white rounded-tr-none shadow-indigo-100":"bg-white text-gray-800 rounded-tl-none border border-gray-100"),children:[e.replyTo&&(0,a.jsxs)("div",{className:(0,u.cn)("mb-2 p-2 rounded-xl text-[10px] border-l-4",e.senderId===t.id?"bg-white/10 border-white/30 text-white/80":"bg-gray-50 border-indigo-500 text-gray-500"),children:[(0,a.jsx)("span",{className:"font-black block uppercase tracking-tighter opacity-50",children:e.replyTo.senderName}),(0,a.jsx)("p",{className:"line-clamp-1",children:e.replyTo.text})]}),e.text.startsWith("\uD83D\uDCF7 Photo:")?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("img",{src:p.B.getMediaUrl(e.text.split(": ")[1]),alt:"Chat attachment",className:"rounded-xl max-w-full h-auto"}),(0,a.jsx)("p",{className:"text-[10px] opacity-70",children:"Cliquer pour agrandir"})]}):e.text.startsWith("\uD83D\uDCC4 Document:")?(0,a.jsxs)("a",{href:p.B.getMediaUrl(e.text.split(": ")[1]),target:"_blank",className:"flex items-center gap-2 underline decoration-white/30",children:[(0,a.jsx)(l.A,{size:16})," Document joint"]}):(0,a.jsx)("div",{className:"prose prose-sm prose-invert max-w-none prose-p:my-0 prose-headings:text-sm prose-headings:my-1",children:(0,a.jsx)(h.oz,{children:e.text})})]})]})]},s)),0===b.length&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full opacity-20",children:[(0,a.jsx)(c.A,{size:48,className:"mb-4"}),(0,a.jsx)("p",{className:"text-xs font-black uppercase",children:"Aucun message"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-white border-t border-gray-100",children:[y&&(0,a.jsxs)("div",{className:"mb-2 p-3 bg-gray-50 rounded-2xl flex items-center justify-between border border-gray-100 animate-in slide-in-from-bottom-1",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-[8px] font-black text-indigo-600 uppercase",children:["En r\xe9ponse \xe0 ",y.senderName]}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:y.text})]}),(0,a.jsx)("button",{onClick:()=>w(null),className:"p-1 text-gray-400",children:(0,a.jsx)(d.A,{size:14})})]}),(0,a.jsxs)("form",{onSubmit:C,className:"flex gap-2 items-end",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*,application/pdf",e.onchange=async e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(a){let e=await p.B.uploadFile(a,"chat/".concat(t.id,"_").concat(Date.now())),s=a.type.startsWith("image/")?"\uD83D\uDCF7 Photo":"\uD83D\uDCC4 Document";await p.B.sendMessage("".concat(s,": ").concat(e))}},e.click()},className:"p-3 bg-gray-50 text-gray-400 rounded-2xl active:scale-95 transition-all",children:(0,a.jsx)(o.A,{size:20})})}),(0,a.jsx)("input",{value:N,onChange:e=>v(e.target.value),placeholder:"Discutez avec votre promo...",className:"flex-1 bg-gray-50 rounded-2xl px-5 py-4 text-sm font-medium outline-none focus:ring-2 ring-indigo-500/10 transition-all"}),(0,a.jsx)("button",{type:"submit",disabled:!N.trim(),className:"bg-indigo-600 text-white p-4 rounded-2xl shadow-lg shadow-indigo-100 active:scale-95 transition-all disabled:opacity-50",children:(0,a.jsx)(x.A,{size:20})})]})]})]})}):null}}},e=>{e.O(0,[233,909,619,765,783,497,530,441,493,358],()=>e(e.s=47069)),_N_E=e.O()}]);