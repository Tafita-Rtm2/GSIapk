(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{21569:(e,t,s)=>{Promise.resolve().then(s.bind(s,9809))},9809:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var a=s(95155),r=s(75951),i=s(31342),l=s(82118),n=s(89832),c=s(51680),d=s(67746),o=s(37195),x=s(91560),u=s(42501),p=s(41983),m=s(689),g=s(48173),h=s.n(g),b=s(90272),f=s(21567),v=s(12115),j=s(76046),N=s(63699),w=s(30814);function y(){var e,t,s,g;let{t:y}=(0,b.o)(),k=(0,j.useRouter)(),[S,A]=(0,v.useState)(null),[C,E]=(0,v.useState)(!1),[I,_]=(0,v.useState)([]),[z,B]=(0,v.useState)([]),[D,F]=(0,v.useState)([]),[L,M]=(0,v.useState)([]),[O,T]=(0,v.useState)("syncing"),[J,V]=(0,v.useState)(null),[P,R]=(0,v.useState)({});(0,v.useEffect)(()=>{let e=N.B.getCurrentUser();if(!e){k.replace("/login/");return}if("admin"===e.role){k.replace("/admin/");return}if("professor"===e.role){k.replace("/professor/");return}A(e);let t=[N.B.subscribeAuth(e=>A(e)),N.B.subscribeLessons({niveau:e.niveau},t=>{B(t.filter(t=>(t.campus.includes(e.campus)||0===t.campus.length)&&(t.filiere.includes(e.filiere)||0===t.filiere.length))),T("ready")}),N.B.subscribeAssignments({niveau:e.niveau},t=>{F(t.filter(t=>(t.campus.includes(e.campus)||0===t.campus.length)&&(t.filiere.includes(e.filiere)||0===t.filiere.length)))}),N.B.subscribeAnnouncements(t=>{M(t.filter(t=>(!t.targetUserId||t.targetUserId===e.id)&&(!t.campus||t.campus.includes(e.campus)||0===t.campus.length)&&(!t.filiere||t.filiere.includes(e.filiere)||0===t.filiere.length)&&(!t.niveau||t.niveau===e.niveau)))})],s=()=>T("offline"),a=()=>T("syncing");return window.addEventListener("offline",s),window.addEventListener("online",a),()=>{t.forEach(e=>e()),window.removeEventListener("offline",s),window.removeEventListener("online",a)}},[k]),(0,v.useEffect)(()=>{if(S)return N.B.subscribeLatestSchedule(S.campus,S.niveau,e=>V(e))},[S]),(0,v.useEffect)(()=>{let e=localStorage.getItem("gsi_progress");e&&R(JSON.parse(e));let t=localStorage.getItem("gsi_read_notifications");t&&_(JSON.parse(t));let s=e=>{R(e.detail)};return window.addEventListener("gsi_progress_updated",s),()=>window.removeEventListener("gsi_progress_updated",s)},[z]);let U=e=>{let t=Array.from(new Set([...I,e]));_(t),localStorage.setItem("gsi_read_notifications",JSON.stringify(t))};if(!S)return null;let q=S.fullName.split(" ")[0],G=L.filter(e=>"convocation"===e.type),H=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][new Date().getDay()],K=60*new Date().getHours()+new Date().getMinutes(),Q=null==J?void 0:null===(g=J.slots)||void 0===g?void 0:null===(s=g.filter(e=>e.day===H&&e.startTime&&e.startTime.includes(":")))||void 0===s?void 0:null===(t=s.map(e=>{try{let[t,s]=e.startTime.split(":").map(Number);return{...e,totalMinutes:(isNaN(t)?0:t)*60+(isNaN(s)?0:s)}}catch(t){return{...e,totalMinutes:0}}}))||void 0===t?void 0:null===(e=t.filter(e=>e.totalMinutes>K))||void 0===e?void 0:e.sort((e,t)=>e.totalMinutes-t.totalMinutes)[0],W=Array.from(new Set(z.map(e=>e.subject)));return(0,a.jsx)(r.e,{children:(0,a.jsxs)("div",{className:"p-6 pb-24 max-w-md mx-auto bg-[#F8FAFC] min-h-screen",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsxs)("div",{className:(0,f.cn)("px-4 py-1.5 rounded-full flex items-center gap-2 text-[10px] font-bold uppercase transition-all","ready"===O?"bg-emerald-100 text-emerald-600":"offline"===O?"bg-orange-100 text-orange-600":"bg-indigo-100 text-indigo-600 animate-pulse"),children:["ready"===O?(0,a.jsx)(i.A,{size:12}):"offline"===O?(0,a.jsx)(l.A,{size:12}):(0,a.jsx)(n.A,{size:12,className:"animate-spin"}),"ready"===O?"Cloud Connect\xe9":"offline"===O?"Mode Local":"Sync GSI Cloud..."]})}),G.length>0&&(0,a.jsxs)("div",{className:"mb-6 bg-rose-50 border-2 border-rose-100 p-5 rounded-[32px] animate-in slide-in-from-top duration-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-rose-500 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-rose-200",children:(0,a.jsx)(c.A,{size:20})}),(0,a.jsx)("h3",{className:"text-rose-600 font-black text-xs uppercase tracking-widest",children:"Convocation Administrative"})]}),(0,a.jsx)("p",{className:"text-[11px] text-rose-500 font-bold leading-relaxed mb-4",children:G[0].message}),(0,a.jsx)("button",{onClick:()=>w.o.success("Confirmation envoy\xe9e \xe0 l'administration."),className:"w-full py-3 bg-rose-500 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-md active:scale-95 transition-all",children:"Confirmer R\xe9ception"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8 pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(h(),{href:"/profile/",className:"w-14 h-14 rounded-[22px] bg-white p-0.5 shadow-xl shadow-indigo-100/50 border border-indigo-50 rotate-[-3deg] hover:rotate-0 transition-all duration-500 overflow-hidden",children:(0,a.jsx)("img",{src:S.photo?N.B.getMediaUrl(S.photo):"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(S.fullName),alt:"Avatar",className:"w-full h-full object-cover rounded-[20px]",onError:e=>{e.currentTarget.src="https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(S.fullName)}})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-400 text-[10px] font-black uppercase tracking-[0.2em] mb-0.5",children:["Bonjour ",q]}),(0,a.jsxs)("h1",{className:"text-xl font-black text-gray-900 tracking-tight leading-none",children:["GSI ",(0,a.jsx)("span",{className:"text-primary",children:"Internationale"})]})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("button",{onClick:()=>E(!C),className:"relative w-12 h-12 flex items-center justify-center bg-white shadow-xl shadow-indigo-100/30 border border-gray-100 rounded-2xl text-gray-400 hover:text-primary transition-all active:scale-90",children:[(0,a.jsx)(d.A,{size:22}),(L.length>0||D.length>0)&&(0,a.jsx)("div",{className:"absolute top-3.5 right-3.5 w-2.5 h-2.5 bg-rose-500 border-[3px] border-white rounded-full shadow-sm"})]})})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-xs font-black uppercase tracking-widest text-gray-400 mb-4 px-1",children:"Votre journ\xe9e en un coup d’œil"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white p-5 rounded-[32px] border border-gray-100 shadow-sm relative overflow-hidden group",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary/10 text-primary rounded-xl flex items-center justify-center",children:(0,a.jsx)(o.A,{size:20})}),(0,a.jsx)("span",{className:"bg-emerald-50 text-emerald-600 px-3 py-1 rounded-full text-[8px] font-black uppercase tracking-widest",children:"Suivant"})]}),Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h4",{className:"font-black text-sm uppercase mb-1",children:Q.subject}),(0,a.jsxs)("p",{className:"text-[10px] font-bold text-gray-500 mb-2",children:[Q.startTime," — Salle ",Q.room]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/initials/svg?seed=".concat(Q.instructor)})}),(0,a.jsx)("span",{className:"text-[9px] font-black text-gray-400 uppercase",children:Q.instructor})]})]}):(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-300 uppercase italic",children:"Aucun cours \xe0 venir aujourd'hui"}),(0,a.jsx)("div",{className:"absolute right-[-10px] top-[-10px] w-20 h-20 bg-primary/5 rounded-full blur-2xl group-hover:bg-primary/10 transition-colors"})]}),(D.length>0||L.length>0)&&(0,a.jsxs)("div",{className:"bg-orange-50/50 p-5 rounded-[32px] border border-orange-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(c.A,{size:16,className:"text-orange-500"}),(0,a.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-orange-600",children:"Alertes Actives"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[D.slice(0,1).map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-[10px]",children:[(0,a.jsxs)("span",{className:"font-bold text-gray-700 truncate mr-2",children:["Devoir: ",e.title]}),(0,a.jsx)("span",{className:"font-black text-orange-600 whitespace-nowrap",children:e.deadline})]},t)),L.filter(e=>"convocation"!==e.type).slice(0,1).map((e,t)=>(0,a.jsxs)("div",{className:"text-[10px] font-bold text-gray-500 truncate italic",children:["Annonce: ",e.title]},t))]})]}),(0,a.jsxs)("div",{className:"bg-white p-5 rounded-[32px] border border-gray-100 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("span",{className:"text-[9px] font-black uppercase text-gray-400",children:"Progression par mati\xe8re"}),(0,a.jsx)(x.A,{size:14,className:"text-emerald-500"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[W.slice(0,4).map((e,t)=>{let s=z.filter(t=>t.subject===e),r=s.reduce((e,t)=>{var s;return e+((null===(s=P[t.id])||void 0===s?void 0:s.percent)||0)},0),i=s.length>0?Math.round(r/s.length):0;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-[8px] font-black uppercase mb-1",children:[(0,a.jsx)("span",{className:"text-gray-600 truncate mr-4",children:e}),(0,a.jsxs)("span",{children:[i,"%"]})]}),(0,a.jsx)("div",{className:"h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:(0,f.cn)("h-full rounded-full transition-all duration-1000",["bg-indigo-500","bg-emerald-500","bg-orange-500","bg-rose-500"][t%4]),style:{width:"".concat(i,"%")}})})]},e)}),0===W.length&&(0,a.jsx)("p",{className:"text-[9px] text-center text-gray-300 uppercase italic",children:"Aucune donn\xe9e disponible"})]})]})]})]}),(0,a.jsx)(h(),{href:"/chat/",className:"block mb-10 group active:scale-[0.98] transition-all",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-[#3F51B5] via-[#5C6BC0] to-[#7986CB] p-7 rounded-[44px] text-white shadow-2xl shadow-indigo-200 relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(Users,{size:18,className:"text-violet-200"}),(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-violet-200",children:"Votre Agent Assistant GSI"})]}),(0,a.jsx)("h2",{className:"text-xl font-black mb-1 leading-tight",children:"Besoin d'aide ?"}),(0,a.jsx)("p",{className:"text-[11px] text-violet-200/80 font-medium mb-4",children:"Votre conseiller d\xe9vou\xe9 est \xe0 votre \xe9coute 24h/24."}),(0,a.jsx)("div",{className:"inline-flex bg-white/10 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest border border-white/10",children:"Ouvrir l'assistant"})]}),(0,a.jsx)("div",{className:"absolute right-[-20px] bottom-[-20px] w-32 h-32 bg-white/5 rounded-full blur-3xl"})]})}),(0,a.jsxs)("div",{className:"mb-10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-end mb-5",children:[(0,a.jsx)("h2",{className:"text-lg font-black text-gray-900 uppercase tracking-tighter",children:"Cours du jour"}),(0,a.jsx)(h(),{href:"/library/",className:"text-[10px] font-bold text-primary uppercase tracking-widest hover:underline",children:"Voir tout"})]}),(0,a.jsxs)("div",{className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",children:[z.map((e,t)=>{var s;let r=null===(s=P[e.id])||void 0===s?void 0:s.completed;return(0,a.jsxs)("div",{className:"min-w-[200px] p-5 bg-white rounded-[32px] border border-gray-100 shadow-sm active:scale-95 transition-all cursor-pointer group relative",onClick:()=>{var t;return(null===(t=e.files)||void 0===t?void 0:t[0])&&N.B.openPackFile(e.id,e.files[0])},children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),N.B.toggleLessonCompleted(e.id);let s=localStorage.getItem("gsi_progress");s&&R(JSON.parse(s)),w.o.success(r?"Marqu\xe9 comme non lu":"F\xe9licitations ! Cours termin\xe9.")},className:(0,f.cn)("absolute top-4 right-4 w-6 h-6 rounded-full border flex items-center justify-center transition-all",r?"bg-emerald-500 border-emerald-500 text-white":"bg-gray-50 border-gray-200 text-gray-300"),children:(0,a.jsx)(i.A,{size:12})}),(0,a.jsx)("div",{className:(0,f.cn)("w-10 h-10 rounded-xl flex items-center justify-center mb-4 transition-colors",r?"bg-emerald-50 text-emerald-500":"bg-indigo-50 text-indigo-500 group-hover:bg-primary group-hover:text-white"),children:(0,a.jsx)(u.A,{size:20})}),(0,a.jsx)("h3",{className:"font-black text-xs text-gray-800 mb-1 line-clamp-1 uppercase",children:e.title}),(0,a.jsx)("p",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest",children:e.subject})]},t)}),0===z.length&&(0,a.jsx)("p",{className:"text-gray-300 text-[10px] font-black uppercase py-10 px-4 border-2 border-dashed border-gray-100 rounded-[32px] text-center w-full",children:"Aucun contenu p\xe9dagogique"})]})]}),(0,a.jsxs)("div",{className:"mb-10",children:[(0,a.jsx)("h2",{className:"text-lg font-black text-gray-900 uppercase tracking-tighter mb-5",children:"Devoirs \xe0 rendre"}),(0,a.jsxs)("div",{className:"space-y-4",children:[D.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white p-6 rounded-[32px] border border-gray-100 shadow-sm relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("span",{className:"bg-orange-50 text-orange-600 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest",children:"En attente"}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-[9px] font-black text-gray-300 uppercase",children:[(0,a.jsx)(o.A,{size:10}),e.deadline]})]}),(0,a.jsx)("h4",{className:"font-black text-sm uppercase tracking-tight mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-[10px] font-bold text-gray-400 mb-4",children:e.subject}),e.files&&e.files.length>0&&(0,a.jsxs)("button",{onClick:()=>N.B.openPackFile(e.id,e.files[0]),className:"w-full py-3 mb-3 bg-indigo-50 text-indigo-600 rounded-xl text-[9px] font-black uppercase tracking-widest flex items-center justify-center gap-2",children:[(0,a.jsx)(p.A,{size:12}),"Consulter les ressources"]}),(0,a.jsx)("button",{onClick:()=>{let t=document.createElement("input");t.type="file",t.onchange=async t=>{let s=t.target.files[0];if(s){let t=w.o.loading('T\xe9l\xe9versement de "'.concat(s.name,'"...'));try{let a=await N.B.uploadFile(s,"submissions/".concat(e.id,"_").concat(S.id,"_").concat(s.name));await N.B.addSubmission({id:Math.random().toString(36).substr(2,9),assignmentId:e.id,studentId:S.id,studentName:S.fullName,date:new Date().toISOString(),file:a,campus:S.campus,filiere:S.filiere,niveau:S.niveau}),w.o.success("Devoir envoy\xe9 avec succ\xe8s !",{id:t})}catch(e){w.o.error("\xc9chec de l'envoi : "+e.message,{id:t})}}},t.click()},className:"w-full py-4 bg-gray-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-primary transition-colors shadow-lg active:scale-95",children:"D\xe9poser mon travail"})]},t)),0===D.length&&(0,a.jsx)("div",{className:"p-10 border-2 border-dashed border-gray-100 rounded-[32px] text-center",children:(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-300 uppercase",children:"Aucune deadline"})})]})]}),C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4 backdrop-blur-md animate-in fade-in duration-300",children:(0,a.jsxs)("div",{className:"bg-white rounded-[48px] w-full max-w-sm overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"p-8 bg-primary text-white flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-black text-sm uppercase tracking-widest",children:"Notifications"}),(0,a.jsx)("p",{className:"text-[9px] font-bold opacity-60 uppercase",children:"Flux GSI Internationale"})]}),(0,a.jsx)("button",{onClick:()=>E(!1),className:"p-3 bg-white/10 rounded-2xl active:scale-90 transition-all",children:(0,a.jsx)(m.A,{size:20})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-3 max-h-[450px] overflow-y-auto bg-gray-50/50",children:[0===L.length&&0===D.length&&(0,a.jsxs)("div",{className:"py-20 flex flex-col items-center text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-gray-300 mb-4",children:(0,a.jsx)(d.A,{size:24})}),(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest italic",children:"Aucune notification pour le moment"})]}),L.map((e,t)=>{let s=I.includes(e.id);return(0,a.jsxs)("div",{className:(0,f.cn)("p-5 rounded-[32px] border transition-all duration-300",s?"bg-white border-gray-100 opacity-60":"bg-white border-indigo-100 shadow-lg shadow-indigo-500/5 ring-1 ring-indigo-500/10"),onClick:()=>U(e.id),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("span",{className:(0,f.cn)("px-2 py-0.5 rounded-full text-[8px] font-black uppercase tracking-widest","convocation"===e.type?"bg-rose-500 text-white":"bg-primary text-white"),children:"convocation"===e.type?"OFFICIEL":"INFO"}),(0,a.jsx)("span",{className:"text-[8px] font-bold text-gray-300",children:new Date(e.date).toLocaleDateString()})]}),(0,a.jsx)("h4",{className:"text-[11px] font-black uppercase mb-1 text-gray-800",children:e.title}),(0,a.jsx)("p",{className:"text-[11px] text-gray-500 font-medium leading-relaxed",children:e.message})]},e.id)}),D.map(e=>(0,a.jsxs)("div",{className:"p-5 bg-orange-50/50 border border-orange-100 rounded-[32px]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"bg-orange-500 text-white px-2 py-0.5 rounded-full text-[8px] font-black uppercase tracking-widest",children:"DEVOIR"}),(0,a.jsx)("span",{className:"text-[8px] font-black text-orange-600 uppercase tracking-widest",children:"\xc0 RENDRE"})]}),(0,a.jsx)("h4",{className:"text-[11px] font-black uppercase mb-1 text-gray-800",children:e.title}),(0,a.jsxs)("p",{className:"text-[10px] text-orange-600 font-bold",children:["Date limite : ",e.deadline]})]},e.id))]}),(0,a.jsx)("div",{className:"p-6 bg-white border-t border-gray-100",children:(0,a.jsx)("button",{onClick:()=>{let e=L.map(e=>e.id);_(e),localStorage.setItem("gsi_read_notifications",JSON.stringify(e)),w.o.success("Tout est marqu\xe9 comme lu")},className:"w-full py-4 bg-gray-50 text-gray-400 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:text-primary transition-colors",children:"Tout marquer comme lu"})})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[260,181,173,947,699,951,441,517,358],()=>t(21569)),_N_E=e.O()}]);