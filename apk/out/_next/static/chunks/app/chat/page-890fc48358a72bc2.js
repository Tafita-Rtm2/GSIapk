(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{18968:(e,t,s)=>{Promise.resolve().then(s.bind(s,69728))},69728:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(95155),r=s(12115),n=s(85592),l=s(96758),i=s(689),o=s(85600),c=s(29609),d=s(21567),u=s(63699),m=s(89268),x=s(30814),p=s(43647),g=s(49220);function h(){let[e,t]=(0,r.useState)(null),[s,h]=(0,r.useState)([]),[v,f]=(0,r.useState)(""),[b,y]=(0,r.useState)(!1),[j,w]=(0,r.useState)(null),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=u.B.getCurrentUser();e&&t(e)},[]),(0,r.useEffect)(()=>{if(e)return u.B.subscribeAiMessages(t=>{if(0===t.length){let t={role:"assistant",content:"Bonjour ".concat(e.fullName.split(" ")[0]," ! Je suis votre Agent Assistant GSI pour le campus de ").concat(e.campus," (").concat(e.filiere,"). Je suis l\xe0 pour vous accompagner personnellement dans votre r\xe9ussite acad\xe9mique et r\xe9pondre \xe0 toutes vos questions comme un v\xe9ritable conseiller d\xe9vou\xe9. Comment puis-je vous assister aujourd'hui ?")};u.B.setAiMessages([t])}else h(t)})},[e]);let A=async()=>{if(!v.trim()&&!j||b)return;let t=[...s,{role:"user",content:v,image:j}];u.B.setAiMessages(t),f(""),w(null),y(!0);try{let a=u.B.getAIConfig();if(!a.apiKey)throw Error("Configuration IA manquante. Contactez un administrateur.");let r=new p.Ay({apiKey:a.apiKey,dangerouslyAllowBrowser:!0}),n=(null==e?void 0:e.campus)||"Antananarivo",l=(null==e?void 0:e.filiere)||"G\xe9n\xe9ral",i="".concat(n,"_").concat(l),o=a.prompts[i]||a.prompts["".concat(n,"_G\xe9n\xe9ral")]||"Tu es l'Agent Assistant, le conseiller IA personnel du Groupe GSI. Tu aides les \xe9tudiants avec leurs cours, exercices et vie de campus. R\xe9ponds toujours avec professionnalisme, empathie et utilise le Markdown pour structurer tes r\xe9ponses (tableaux, code, titres).",c=(await u.B.getLessons()).filter(t=>t.niveau===(null==e?void 0:e.niveau)).slice(0,3),d=(await u.B.getAssignments()).filter(t=>t.niveau===(null==e?void 0:e.niveau)).slice(0,3),m=(await u.B.getGrades()).filter(t=>t.studentId===(null==e?void 0:e.id)),x="\n        TON IDENTIT\xc9 ET R\xd4LE:\n        Tu es l'Agent Assistant Officiel du Groupe GSI.\n        Tu n'es pas une simple IA, tu es un conseiller humain et chaleureux.\n        \n        CONTEXTE DE L'\xc9TUDIANT \xc0 QUI TU PARLES:\n        Nom: ".concat(null==e?void 0:e.fullName,"\n        Campus: ").concat(n,"\n        Fili\xe8re: ").concat(l,"\n        Niveau: ").concat(null==e?void 0:e.niveau,"\n        Moyenne actuelle: ").concat(m.length>0?(m.reduce((e,t)=>e+t.score,0)/m.length).toFixed(2)+"/20":"N/A","\n        Cours r\xe9cents: ").concat(c.map(e=>e.title).join(", "),"\n        Devoirs \xe0 faire: ").concat(d.map(e=>e.title+" (DL: "+e.deadline+")").join(", "),"\n      "),g=[{role:"system",content:o+"\n\n"+x}];s.slice(-10).forEach(e=>{g.push({role:e.role,content:e.content})}),j?g.push({role:"user",content:[{type:"text",text:v||"Analyse cette image pour m'aider dans mes \xe9tudes."},{type:"image_url",image_url:{url:j}}]}):g.push({role:"user",content:v});let h=(await r.chat.completions.create({model:j?"gpt-4o":"gpt-3.5-turbo",messages:g})).choices[0].message.content||"Je n'ai pas pu g\xe9n\xe9rer de r\xe9ponse.";u.B.setAiMessages([...t,{role:"assistant",content:h}])}catch(e){x.o.error(e.message),u.B.setAiMessages([...t,{role:"assistant",content:"D\xe9sol\xe9e, j'ai une difficult\xe9 technique (OpenAI). V\xe9rifiez la cl\xe9 API ou votre connexion."}])}finally{y(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col h-screen max-w-md mx-auto bg-white shadow-xl overflow-hidden relative",children:[(0,a.jsx)(m.z,{title:"Agent Assistant",subtitle:"GSI Agent Assistant",className:"p-6 bg-primary text-white mb-0",rightElement:(0,a.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-md",children:(0,a.jsx)(n.A,{size:20})})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50/50",children:[s.map((e,t)=>(0,a.jsxs)("div",{className:(0,d.cn)("flex flex-col animate-in fade-in slide-in-from-bottom-2","user"===e.role?"items-end":"items-start"),children:[e.image&&(0,a.jsx)("div",{className:"mb-2 max-w-[70%] rounded-2xl overflow-hidden shadow-md border-4 border-white",children:(0,a.jsx)("img",{src:e.image,alt:"User upload",className:"w-full h-auto"})}),(0,a.jsx)("div",{className:(0,d.cn)("max-w-[90%] p-4 rounded-[24px] text-sm font-medium shadow-sm relative group","user"===e.role?"bg-primary text-white rounded-tr-none shadow-primary/20":"bg-white text-gray-800 rounded-tl-none border border-gray-100"),children:"assistant"===e.role?(0,a.jsx)("div",{className:"prose prose-sm prose-indigo max-w-none",children:(0,a.jsx)(g.oz,{components:{code(e){let{node:t,className:s,children:r,...n}=e;/language-(\w+)/.exec(s||"");let i=String(r).replace(/\n$/,"");return(0,a.jsxs)("div",{className:"relative my-4 group/code",children:[(0,a.jsx)("div",{className:"bg-gray-900 text-gray-100 p-4 rounded-xl font-mono text-xs overflow-x-auto",children:r}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(i),x.o.success("Code copi\xe9 !")},className:"absolute top-2 right-2 p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white opacity-0 group-hover/code:opacity-100 transition-opacity",children:(0,a.jsx)(l.A,{size:14})})]})},table(e){let{children:t}=e;return(0,a.jsx)("div",{className:"overflow-x-auto my-4",children:(0,a.jsx)("table",{className:"w-full border-collapse border border-gray-200 text-xs",children:t})})},th(e){let{children:t}=e;return(0,a.jsx)("th",{className:"border border-gray-200 p-2 bg-gray-50 font-black uppercase",children:t})},td(e){let{children:t}=e;return(0,a.jsx)("td",{className:"border border-gray-200 p-2",children:t})}},children:e.content})}):e.content}),(0,a.jsx)("span",{className:"text-[8px] text-gray-300 mt-1 px-2 uppercase font-black",children:"user"===e.role?"\xc9tudiant":"Agent Assistant GSI"})]},t)),b&&(0,a.jsx)("div",{className:"flex flex-col items-start animate-pulse",children:(0,a.jsx)("div",{className:"bg-white text-gray-400 p-4 rounded-[24px] rounded-tl-none border border-gray-100 text-xs font-bold italic",children:"L'agent assistant r\xe9fl\xe9chit..."})})]}),(0,a.jsxs)("div",{className:"p-4 bg-white border-t border-gray-100 space-y-3",children:[j&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-2xl animate-in zoom-in",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl overflow-hidden border border-gray-200",children:(0,a.jsx)("img",{src:j,className:"w-full h-full object-cover"})}),(0,a.jsx)("p",{className:"text-[10px] font-bold text-gray-400 flex-1",children:"Image pr\xeate pour analyse"}),(0,a.jsx)("button",{onClick:()=>w(null),className:"p-2 text-rose-500 hover:bg-rose-50 rounded-full",children:(0,a.jsx)(i.A,{size:16})})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("input",{type:"file",ref:N,onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){let e=new FileReader;e.onloadend=()=>{w(e.result)},e.readAsDataURL(s)}},accept:"image/*",className:"hidden"}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},className:"p-4 bg-gray-100 text-gray-500 rounded-2xl hover:bg-gray-200 transition-all active:scale-90",children:(0,a.jsx)(o.A,{size:20})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("input",{type:"text",value:v,onChange:e=>f(e.target.value),onKeyDown:e=>"Enter"===e.key&&A(),placeholder:"Posez votre question...",className:"w-full bg-gray-100 rounded-2xl px-5 py-4 outline-none text-sm font-medium focus:ring-2 ring-primary/20 transition-all"}),v&&(0,a.jsx)("button",{onClick:()=>f(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,a.jsx)(i.A,{size:16})})]}),(0,a.jsx)("button",{onClick:A,disabled:!v.trim(),className:"bg-primary text-white p-4 rounded-2xl shadow-lg shadow-primary/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:scale-100",children:(0,a.jsx)(c.A,{size:20})})]})]})]})}},89268:(e,t,s)=>{"use strict";s.d(t,{z:()=>i});var a=s(95155),r=s(25012),n=s(76046),l=s(21567);function i(e){let{title:t,subtitle:s,onBack:i,rightElement:o,className:c}=e,d=(0,n.useRouter)();return(0,a.jsxs)("div",{className:(0,l.cn)("flex items-center justify-between mb-6 gap-4",c),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>{i?i():d.back()},className:"p-2 bg-gray-100 rounded-xl text-gray-500 hover:bg-gray-200 active:scale-90 transition-all",children:(0,a.jsx)(r.A,{size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-800 leading-tight",children:t}),s&&(0,a.jsx)("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest",children:s})]})]}),o&&(0,a.jsx)("div",{children:o})]})}},21567:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var a=s(43463),r=s(69795);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[260,181,764,442,890,699,441,517,358],()=>t(18968)),_N_E=e.O()}]);