(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{4646:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(5155),l=s(9294),i=s(5571),r=s(6943),n=s(4294);let d=(0,n.A)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),c=(0,n.A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var o=s(6615);let x=(0,n.A)("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]);var m=s(4979),p=s(2115),u=s(4824),h=s(5016);function g(){let{t:e}=(0,i.o)(),[t,s]=(0,p.useState)(null),[n,g]=(0,p.useState)([]),[f,b]=(0,p.useState)([]),[j,N]=(0,p.useState)(""),[y,v]=(0,p.useState)(null),w=(0,p.useRef)(null);(0,p.useEffect)(()=>{s(u.B.getCurrentUser());let e=u.B.subscribeMessages(e=>{b(e),setTimeout(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},100)}),t=u.B.subscribeUsers(e=>g(e));return()=>{e(),t()}},[]);let k=async e=>{if(e.preventDefault(),!j.trim())return;let t=j.trim(),s=y?{senderName:y.senderName,text:y.text}:void 0;N(""),v(null),await u.B.sendMessage(t,s)};return t?(0,a.jsx)(l.e,{children:(0,a.jsxs)("div",{className:"flex flex-col h-full bg-[#F8FAFC]",children:[(0,a.jsxs)("div",{className:"p-6 bg-white border-b border-gray-100 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-black text-gray-900 uppercase tracking-tight",children:"Communaut\xe9"}),(0,a.jsxs)("p",{className:"text-[9px] font-bold text-indigo-500 uppercase tracking-widest",children:[t.filiere," â€¢ ",t.niveau]})]}),(0,a.jsxs)("div",{className:"bg-indigo-50 px-3 py-1 rounded-full flex items-center gap-2",children:[(0,a.jsx)(r.A,{size:12,className:"text-indigo-600"}),(0,a.jsx)("span",{className:"text-[10px] font-black text-indigo-600",children:"En ligne"})]})]}),(0,a.jsxs)("div",{ref:w,className:"flex-1 overflow-y-auto p-6 space-y-6",children:[f.map((e,s)=>(0,a.jsxs)("div",{className:(0,h.cn)("flex gap-3 animate-in fade-in slide-in-from-bottom-2",e.senderId===t.id?"flex-row-reverse":"flex-row"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-indigo-50 border-2 border-white shadow-sm flex-shrink-0 overflow-hidden flex items-center justify-center",children:(0,a.jsx)("img",{src:(e=>{let t=n.find(t=>t.id===e.senderId),s=(null==t?void 0:t.photo)||e.senderPhoto;return u.B.getMediaUrl(s)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e.senderName)})(e),alt:"",className:"w-full h-full object-cover",onError:t=>{t.target.onerror=null,t.target.src="https://api.dicebear.com/7.x/initials/svg?seed=".concat(e.senderName)}})}),(0,a.jsxs)("div",{className:(0,h.cn)("flex flex-col max-w-[75%]",e.senderId===t.id?"items-end":"items-start"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1 px-1",children:[e.senderId!==t.id&&(0,a.jsx)("span",{className:"text-[9px] font-black text-gray-400 uppercase",children:e.senderName}),(0,a.jsx)("span",{className:"text-[7px] text-gray-300 font-bold",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{onContextMenu:t=>{t.preventDefault(),v(e)},onClick:()=>v(e),className:(0,h.cn)("p-4 rounded-[24px] text-sm font-medium shadow-sm active:scale-[0.98] transition-transform overflow-hidden",e.senderId===t.id?"bg-indigo-600 text-white rounded-tr-none shadow-indigo-100":"bg-white text-gray-800 rounded-tl-none border border-gray-100"),children:[e.replyTo&&(0,a.jsxs)("div",{className:(0,h.cn)("mb-2 p-2 rounded-xl text-[10px] border-l-4",e.senderId===t.id?"bg-white/10 border-white/30 text-white/80":"bg-gray-50 border-indigo-500 text-gray-500"),children:[(0,a.jsx)("span",{className:"font-black block uppercase tracking-tighter opacity-50",children:e.replyTo.senderName}),(0,a.jsx)("p",{className:"line-clamp-1",children:e.replyTo.text})]}),e.text.startsWith("\uD83D\uDCF7 Photo:")?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("img",{src:u.B.getMediaUrl(e.text.split(": ")[1]),alt:"Chat attachment",className:"rounded-xl max-w-full h-auto"}),(0,a.jsx)("p",{className:"text-[10px] opacity-70",children:"Cliquer pour agrandir"})]}):e.text.startsWith("\uD83D\uDCC4 Document:")?(0,a.jsxs)("a",{href:u.B.getMediaUrl(e.text.split(": ")[1]),target:"_blank",className:"flex items-center gap-2 underline decoration-white/30",children:[(0,a.jsx)(d,{size:16})," Document joint"]}):e.text]})]})]},s)),0===f.length&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full opacity-20",children:[(0,a.jsx)(c,{size:48,className:"mb-4"}),(0,a.jsx)("p",{className:"text-xs font-black uppercase",children:"Aucun message"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-white border-t border-gray-100",children:[y&&(0,a.jsxs)("div",{className:"mb-2 p-3 bg-gray-50 rounded-2xl flex items-center justify-between border border-gray-100 animate-in slide-in-from-bottom-1",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-[8px] font-black text-indigo-600 uppercase",children:["En r\xe9ponse \xe0 ",y.senderName]}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:y.text})]}),(0,a.jsx)("button",{onClick:()=>v(null),className:"p-1 text-gray-400",children:(0,a.jsx)(o.A,{size:14})})]}),(0,a.jsxs)("form",{onSubmit:k,className:"flex gap-2 items-end",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*,application/pdf",e.onchange=async e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(a){let e=await u.B.uploadFile(a,"chat/".concat(t.id,"_").concat(Date.now())),s=a.type.startsWith("image/")?"\uD83D\uDCF7 Photo":"\uD83D\uDCC4 Document";await u.B.sendMessage("".concat(s,": ").concat(e))}},e.click()},className:"p-3 bg-gray-50 text-gray-400 rounded-2xl active:scale-95 transition-all",children:(0,a.jsx)(x,{size:20})})}),(0,a.jsx)("input",{value:j,onChange:e=>N(e.target.value),placeholder:"Discutez avec votre promo...",className:"flex-1 bg-gray-50 rounded-2xl px-5 py-4 text-sm font-medium outline-none focus:ring-2 ring-indigo-500/10 transition-all"}),(0,a.jsx)("button",{type:"submit",disabled:!j.trim(),className:"bg-indigo-600 text-white p-4 rounded-2xl shadow-lg shadow-indigo-100 active:scale-95 transition-all disabled:opacity-50",children:(0,a.jsx)(m.A,{size:20})})]})]})]})}):null}},4979:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(4294).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},9984:(e,t,s)=>{Promise.resolve().then(s.bind(s,4646))}},e=>{e.O(0,[594,720,909,874,824,294,441,493,358],()=>e(e.s=9984)),_N_E=e.O()}]);