"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{6532:(e,r,t)=>{t.r(r),t.d(r,{GSIViewer:()=>x});var l=t(5155),s=t(2115),a=t(9139),o=t(3318),n=t(2033),i=t(7971),c=t(850),d=t(1190),u=t(3263);function x(e){let{url:r,type:t,onLoadComplete:x,onError:m}=e,[h,g]=(0,s.useState)(!0),[p,f]=(0,s.useState)(null),[b,w]=(0,s.useState)(1.5),[v,y]=(0,s.useState)(null);(0,s.useRef)(null);let j=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(console.log("[GSI-DEBUG] Viewer type: ".concat(t)),console.log("[GSI-DEBUG] Original URL: ".concat(r)),!r||"undefined"===r){null==m||m("URL du fichier invalide."),g(!1);return}g(!0),"pdf"===t?N():"docx"===t?k():"video"===t||"image"===t?(g(!1),null==x||x()):(g(!1),null==m||m("Type de fichier non reconnu."))},[r,t]);let N=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;try{let l=r.startsWith("http")?"/web/api/proxy?url=".concat(encodeURIComponent(r)):r,s=a.YE({url:l,withCredentials:!1}),o=await s.promise;f({numPages:o.numPages,currentPage:e});let n=await o.getPage(e),i=n.getViewport({scale:t}),c=j.current;if(!c)return;let d=c.getContext("2d");if(!d)return;c.height=i.height,c.width=i.width,await n.render({canvasContext:d,viewport:i}).promise,g(!1),null==x||x()}catch(e){console.error("PDF Render Error:",e),g(!1),null==m||m("Erreur de rendu PDF: ".concat(e.message||"Fichier invalide"))}},k=async()=>{try{console.log("GSIViewer: Rendering DOCX from",r);let e=await fetch(r);if(!e.ok)throw Error("HTTP ".concat(e.status," - \xc9chec du chargement du fichier."));let t=await e.arrayBuffer();if(0===t.byteLength)throw Error("Fichier vide ou corrompu.");let l=o.convertToHtml||(null==o?void 0:o.convertToHtml)||o.convertToHtml;if("function"!=typeof l)throw Error("Moteur de rendu DOCX non disponible.");let s=await l({arrayBuffer:t},{styleMap:["p[style-name='Title'] => h1:fresh","p[style-name='Heading 1'] => h2:fresh","p[style-name='Heading 2'] => h3:fresh"]});y(s.value),s.messages.length>0&&console.warn("Mammoth messages:",s.messages),g(!1),null==x||x()}catch(e){console.error("DOCX Render Error:",e),g(!1),null==m||m("Erreur de rendu DOCX: ".concat(e.message))}},E=e=>{if(!p)return;let r=p.currentPage+e;r>=1&&r<=p.numPages&&(g(!0),N(r))},C=e=>{let r=Math.min(Math.max(b+e,.5),4);w(r),"pdf"===t&&(g(!0),N((null==p?void 0:p.currentPage)||1,r))};return(0,l.jsxs)("div",{className:"w-full h-full flex flex-col bg-gray-50 overflow-hidden",children:[h&&(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 z-20 backdrop-blur-sm",children:[(0,l.jsx)(n.A,{className:"w-10 h-10 text-primary animate-spin mb-4"}),(0,l.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"GSI Rendering Engine..."})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-auto flex flex-col items-center p-4",children:["pdf"===t&&(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("div",{className:"overflow-auto max-w-full",children:(0,l.jsx)("canvas",{ref:j,className:"shadow-2xl rounded-sm bg-white mx-auto",style:{width:"auto",height:"auto"}})}),(0,l.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 z-30",children:[(0,l.jsxs)("div",{className:"bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100",children:[(0,l.jsx)("button",{onClick:()=>C(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,l.jsx)(i.A,{size:20})}),(0,l.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(100*b),"%"]}),(0,l.jsx)("button",{onClick:()=>C(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,l.jsx)(c.A,{size:20})})]}),p&&(0,l.jsxs)("div",{className:"bg-gray-900/90 text-white px-6 py-3 rounded-full flex items-center gap-6 backdrop-blur-md shadow-2xl border border-white/10",children:[(0,l.jsx)("button",{onClick:()=>E(-1),disabled:p.currentPage<=1,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,l.jsx)(d.A,{size:24})}),(0,l.jsxs)("span",{className:"text-[10px] font-black uppercase tracking-widest whitespace-nowrap",children:["Page ",p.currentPage," / ",p.numPages]}),(0,l.jsx)("button",{onClick:()=>E(1),disabled:p.currentPage>=p.numPages,className:"disabled:opacity-20 active:scale-90 transition-all",children:(0,l.jsx)(u.A,{size:24})})]})]})]}),"docx"===t&&v&&(0,l.jsx)("div",{className:"w-full max-w-2xl bg-white p-8 shadow-lg rounded-2xl prose prose-sm prose-indigo animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:v}})}),"video"===t&&(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-black rounded-3xl overflow-hidden shadow-2xl",children:(0,l.jsxs)("video",{className:"w-full max-h-full",controls:!0,autoPlay:!0,playsInline:!0,muted:!0,controlsList:"nodownload",onLoadedData:()=>{console.log("[GSI-DEBUG] Video loaded successfully"),g(!1),null==x||x()},onError:e=>{console.error("[GSI-DEBUG] Video load error",e),g(!1),null==m||m("Format vid\xe9o non support\xe9 ou acc\xe8s refus\xe9.")},children:[r.startsWith("http")?(0,l.jsx)("source",{src:"/web/api/proxy?url=".concat(encodeURIComponent(r)),type:"video/mp4"}):(0,l.jsx)("source",{src:r,type:"video/mp4"}),(0,l.jsx)("source",{src:r,type:"video/mp4"}),"Votre navigateur ne supporte pas la lecture de vid\xe9os."]},r)}),"image"===t&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,l.jsx)("div",{className:"overflow-auto max-w-full rounded-2xl shadow-xl",children:(0,l.jsx)("img",{src:r.startsWith("http")?"/web/api/proxy?url=".concat(encodeURIComponent(r)):r,style:{transform:"scale(".concat(b/1.5,")"),transformOrigin:"top center"},className:"h-auto transition-transform duration-200",alt:"Document",onLoad:()=>{console.log("[GSI-DEBUG] Image loaded successfully"),g(!1),null==x||x()},onError:e=>{console.error("[GSI-DEBUG] Image load error",e),g(!1),null==m||m("\xc9chec du chargement de l'image. V\xe9rifiez la connexion ou les permissions.")}})}),(0,l.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md p-1.5 rounded-2xl flex gap-1 shadow-xl border border-gray-100 z-30",children:[(0,l.jsx)("button",{onClick:()=>C(-.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,l.jsx)(i.A,{size:20})}),(0,l.jsxs)("div",{className:"px-3 flex items-center text-[10px] font-bold text-gray-400 border-x border-gray-100",children:[Math.round(b/1.5*100),"%"]}),(0,l.jsx)("button",{onClick:()=>C(.25),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-all",children:(0,l.jsx)(c.A,{size:20})})]})]})]})]})}a.EA.workerSrc="https://unpkg.com/pdfjs-dist@5.4.624/build/pdf.worker.min.mjs"}}]);